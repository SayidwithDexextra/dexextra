/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/metric-ai/route";
exports.ids = ["app/api/metric-ai/route"];
exports.modules = {

/***/ "(rsc)/../node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fmetric-ai%2Froute&page=%2Fapi%2Fmetric-ai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmetric-ai%2Froute.ts&appDir=%2FUsers%2Fgplay_sayid%2FDesktop%2FCODE%2Fdexextra%2Fmetric-ai-worker%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgplay_sayid%2FDesktop%2FCODE%2Fdexextra%2Fmetric-ai-worker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ../node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fmetric-ai%2Froute&page=%2Fapi%2Fmetric-ai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmetric-ai%2Froute.ts&appDir=%2FUsers%2Fgplay_sayid%2FDesktop%2FCODE%2Fdexextra%2Fmetric-ai-worker%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgplay_sayid%2FDesktop%2FCODE%2Fdexextra%2Fmetric-ai-worker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \********************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   workAsyncStorage: () => (/* binding */ workAsyncStorage),\n/* harmony export */   workUnitAsyncStorage: () => (/* binding */ workUnitAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/route-modules/app-route/module.compiled */ \"(rsc)/../node_modules/next/dist/server/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/route-kind */ \"(rsc)/../node_modules/next/dist/server/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/../node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_gplay_sayid_Desktop_CODE_dexextra_metric_ai_worker_app_api_metric_ai_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/metric-ai/route.ts */ \"(rsc)/./app/api/metric-ai/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/metric-ai/route\",\n        pathname: \"/api/metric-ai\",\n        filename: \"route\",\n        bundlePath: \"app/api/metric-ai/route\"\n    },\n    resolvedPagePath: \"/Users/gplay_sayid/Desktop/CODE/dexextra/metric-ai-worker/app/api/metric-ai/route.ts\",\n    nextConfigOutput,\n    userland: _Users_gplay_sayid_Desktop_CODE_dexextra_metric_ai_worker_app_api_metric_ai_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { workAsyncStorage, workUnitAsyncStorage, serverHooks } = routeModule;\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        workAsyncStorage,\n        workUnitAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi4vbm9kZV9tb2R1bGVzL25leHQvZGlzdC9idWlsZC93ZWJwYWNrL2xvYWRlcnMvbmV4dC1hcHAtbG9hZGVyL2luZGV4LmpzP25hbWU9YXBwJTJGYXBpJTJGbWV0cmljLWFpJTJGcm91dGUmcGFnZT0lMkZhcGklMkZtZXRyaWMtYWklMkZyb3V0ZSZhcHBQYXRocz0mcGFnZVBhdGg9cHJpdmF0ZS1uZXh0LWFwcC1kaXIlMkZhcGklMkZtZXRyaWMtYWklMkZyb3V0ZS50cyZhcHBEaXI9JTJGVXNlcnMlMkZncGxheV9zYXlpZCUyRkRlc2t0b3AlMkZDT0RFJTJGZGV4ZXh0cmElMkZtZXRyaWMtYWktd29ya2VyJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmdwbGF5X3NheWlkJTJGRGVza3RvcCUyRkNPREUlMkZkZXhleHRyYSUyRm1ldHJpYy1haS13b3JrZXImaXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O0FBQStGO0FBQ3ZDO0FBQ3FCO0FBQ29DO0FBQ2pIO0FBQ0E7QUFDQTtBQUNBLHdCQUF3Qix5R0FBbUI7QUFDM0M7QUFDQSxjQUFjLGtFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsc0RBQXNEO0FBQzlEO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQzBGOztBQUUxRiIsInNvdXJjZXMiOlsiIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IEFwcFJvdXRlUm91dGVNb2R1bGUgfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9yb3V0ZS1tb2R1bGVzL2FwcC1yb3V0ZS9tb2R1bGUuY29tcGlsZWRcIjtcbmltcG9ydCB7IFJvdXRlS2luZCB9IGZyb20gXCJuZXh0L2Rpc3Qvc2VydmVyL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvZ3BsYXlfc2F5aWQvRGVza3RvcC9DT0RFL2RleGV4dHJhL21ldHJpYy1haS13b3JrZXIvYXBwL2FwaS9tZXRyaWMtYWkvcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL21ldHJpYy1haS9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL21ldHJpYy1haVwiLFxuICAgICAgICBmaWxlbmFtZTogXCJyb3V0ZVwiLFxuICAgICAgICBidW5kbGVQYXRoOiBcImFwcC9hcGkvbWV0cmljLWFpL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2dwbGF5X3NheWlkL0Rlc2t0b3AvQ09ERS9kZXhleHRyYS9tZXRyaWMtYWktd29ya2VyL2FwcC9hcGkvbWV0cmljLWFpL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgd29ya0FzeW5jU3RvcmFnZSwgd29ya1VuaXRBc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmZ1bmN0aW9uIHBhdGNoRmV0Y2goKSB7XG4gICAgcmV0dXJuIF9wYXRjaEZldGNoKHtcbiAgICAgICAgd29ya0FzeW5jU3RvcmFnZSxcbiAgICAgICAgd29ya1VuaXRBc3luY1N0b3JhZ2VcbiAgICB9KTtcbn1cbmV4cG9ydCB7IHJvdXRlTW9kdWxlLCB3b3JrQXN5bmNTdG9yYWdlLCB3b3JrVW5pdEFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwiaWdub3JlTGlzdCI6W10sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/../node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fmetric-ai%2Froute&page=%2Fapi%2Fmetric-ai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmetric-ai%2Froute.ts&appDir=%2FUsers%2Fgplay_sayid%2FDesktop%2FCODE%2Fdexextra%2Fmetric-ai-worker%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgplay_sayid%2FDesktop%2FCODE%2Fdexextra%2Fmetric-ai-worker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*******************************************************************************************************!*\
  !*** ../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "(rsc)/./app/api/metric-ai/route.ts":
/*!************************************!*\
  !*** ./app/api/metric-ai/route.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

"use strict";
eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   OPTIONS: () => (/* binding */ OPTIONS),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   maxDuration: () => (/* binding */ maxDuration),\n/* harmony export */   runtime: () => (/* binding */ runtime)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/../node_modules/next/dist/api/server.js\");\n/* harmony import */ var zod__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! zod */ \"(rsc)/../node_modules/zod/v3/types.js\");\n/* harmony import */ var openai__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! openai */ \"(rsc)/../node_modules/openai/index.mjs\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/../node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\n\n\n\nconst runtime = 'nodejs';\nconst maxDuration = 120;\nconst InputSchema = zod__WEBPACK_IMPORTED_MODULE_2__.object({\n    metric: zod__WEBPACK_IMPORTED_MODULE_2__.string().min(1).max(500),\n    description: zod__WEBPACK_IMPORTED_MODULE_2__.string().optional(),\n    urls: zod__WEBPACK_IMPORTED_MODULE_2__.array(zod__WEBPACK_IMPORTED_MODULE_2__.string().url()).min(1).max(10),\n    related_market_id: zod__WEBPACK_IMPORTED_MODULE_2__.string().optional(),\n    related_market_identifier: zod__WEBPACK_IMPORTED_MODULE_2__.string().optional(),\n    user_address: zod__WEBPACK_IMPORTED_MODULE_2__.string().optional(),\n    context: zod__WEBPACK_IMPORTED_MODULE_2__[\"enum\"]([\n        'create',\n        'settlement'\n    ]).optional()\n});\nconst MAX_RAW_HTML_CHARS = Number(process.env.METRIC_AI_MAX_RAW_HTML_CHARS || 250000);\nconst MAX_SOURCE_DIGEST_CHARS = Number(process.env.METRIC_AI_MAX_SOURCE_DIGEST_CHARS || 9000);\nconst MAX_SOURCES_JOIN_CHARS = Number(process.env.METRIC_AI_MAX_SOURCES_JOIN_CHARS || 30000);\nconst MAX_KEY_LINES = Number(process.env.METRIC_AI_MAX_KEY_LINES || 60);\nconst MAX_CHART_SNIPPETS = Number(process.env.METRIC_AI_MAX_CHART_SNIPPETS || 8);\nfunction getSupabase() {\n    const url = \"https://khhknmobkkkvvogznxdj.supabase.co\" || 0;\n    const key = process.env.SUPABASE_SERVICE_ROLE_KEY || process.env.SUPABASE_SERVICE_KEY;\n    if (!url || !key) throw new Error('Supabase env missing');\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_3__.createClient)(url, key, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false\n        }\n    });\n}\nfunction safeText(s) {\n    return String(s ?? '').replace(/\\s+/g, ' ').trim();\n}\nfunction decodeBasicEntities(input) {\n    return input.replace(/&nbsp;/gi, ' ').replace(/&amp;/gi, '&').replace(/&quot;/gi, '\"').replace(/&#39;/gi, \"'\").replace(/&lt;/gi, '<').replace(/&gt;/gi, '>');\n}\nfunction stripTagsToLines(html) {\n    // Keep line breaks so we can select \"price-looking\" lines instead of one giant blob.\n    const withBreaks = html.replace(/<script[\\s\\S]*?<\\/script>/gi, '\\n').replace(/<style[\\s\\S]*?<\\/style>/gi, '\\n').replace(/<\\/(p|div|li|tr|td|th|h1|h2|h3|h4|h5|h6|section|article|header|footer|br)\\s*>/gi, '\\n').replace(/<(br|hr)\\s*\\/?>/gi, '\\n').replace(/<[^>]+>/g, ' ');\n    return decodeBasicEntities(withBreaks).replace(/\\r\\n/g, '\\n').replace(/[ \\t]+\\n/g, '\\n').replace(/\\n{3,}/g, '\\n\\n').trim();\n}\nfunction collectKeyLines(text, extraKeywords) {\n    const base = [\n        'price',\n        'last',\n        'close',\n        'closing',\n        'open',\n        'high',\n        'low',\n        'quote',\n        'bid',\n        'ask',\n        'usd',\n        'eur',\n        'gbp',\n        'btc',\n        'eth',\n        'per ',\n        '$'\n    ];\n    const kw = [\n        ...base,\n        ...extraKeywords\n    ].map((k)=>k.toLowerCase());\n    const lines = text.split('\\n').map((l)=>l.trim()).filter(Boolean);\n    const picked = [];\n    for (const line of lines){\n        const low = line.toLowerCase();\n        const hasKw = kw.some((k)=>k === '$' ? low.includes('$') : low.includes(k));\n        const hasNumber = /[-+]?\\d{1,3}(?:[,\\d]{0,12})?(?:\\.\\d+)?/.test(line);\n        if (hasKw && hasNumber) picked.push(line);\n        if (picked.length >= MAX_KEY_LINES) break;\n    }\n    // If we found nothing, fall back to the first few dense numeric lines.\n    if (picked.length === 0) {\n        for (const line of lines){\n            if ((line.match(/\\d/g) || []).length >= 6) picked.push(line);\n            if (picked.length >= Math.min(20, MAX_KEY_LINES)) break;\n        }\n    }\n    return picked;\n}\nfunction extractMetaTags(html) {\n    const readMeta = (re)=>{\n        const m = html.match(re);\n        return m?.[1] ? decodeBasicEntities(m[1]).trim() : '';\n    };\n    const title = readMeta(/<title[^>]*>([\\s\\S]{0,500}?)<\\/title>/i);\n    const ogTitle = readMeta(/<meta[^>]+property=[\"']og:title[\"'][^>]+content=[\"']([^\"']{0,500})[\"'][^>]*>/i);\n    const desc = readMeta(/<meta[^>]+name=[\"']description[\"'][^>]+content=[\"']([^\"']{0,800})[\"'][^>]*>/i);\n    const ogDesc = readMeta(/<meta[^>]+property=[\"']og:description[\"'][^>]+content=[\"']([^\"']{0,800})[\"'][^>]*>/i);\n    return {\n        title: safeText(ogTitle || title),\n        description: safeText(ogDesc || desc)\n    };\n}\nfunction extractJsonLdPrices(html) {\n    // Look for Product/Offer style JSON-LD where price is structured.\n    const out = [];\n    const re = /<script[^>]+type=[\"']application\\/ld\\+json[\"'][^>]*>([\\s\\S]*?)<\\/script>/gi;\n    let m;\n    while(m = re.exec(html)){\n        const raw = (m[1] || '').trim();\n        if (!raw) continue;\n        try {\n            const json = JSON.parse(raw);\n            const stack = [\n                json\n            ];\n            while(stack.length){\n                const cur = stack.pop();\n                if (!cur) continue;\n                if (Array.isArray(cur)) {\n                    for (const x of cur)stack.push(x);\n                    continue;\n                }\n                if (typeof cur === 'object') {\n                    // Offer-like nodes\n                    const price = cur.price ?? cur.lowPrice ?? cur.highPrice;\n                    const currency = cur.priceCurrency ?? cur.currency;\n                    if (price != null) {\n                        out.push({\n                            currency: currency ? String(currency) : undefined,\n                            price: String(price),\n                            context: cur['@type'] ? String(cur['@type']) : undefined\n                        });\n                    }\n                    for (const v of Object.values(cur))stack.push(v);\n                }\n            }\n        } catch  {\n        // ignore invalid json-ld\n        }\n        if (out.length >= 10) break;\n    }\n    return out;\n}\nfunction extractChartSignals(rawHtml) {\n    // Many \"chart\" pages render price data inside inline scripts / embedded JSON.\n    // We do NOT execute JS; we just pattern-match likely OHLC/candlestick payloads.\n    const html = rawHtml;\n    const snippets = [];\n    // 1) OHLC arrays: [ts, open, high, low, close]\n    const ohlcRe = /\\[\\s*(\\d{10,13})\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*\\]/g;\n    let lastOhlc = null;\n    let om;\n    while(om = ohlcRe.exec(html)){\n        lastOhlc = {\n            ts: om[1],\n            open: om[2],\n            high: om[3],\n            low: om[4],\n            close: om[5]\n        };\n    }\n    // 2) Object-based candlesticks: {time:..., open:..., high:..., low:..., close:...}\n    const objRe = /\\{\\s*[^{}]{0,2000}?\\bopen\\s*:\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*\\bhigh\\s*:\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*\\blow\\s*:\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*,\\s*\\bclose\\s*:\\s*([-+]?\\d+(?:\\.\\d+)?)\\s*[,}]/g;\n    let lastObj = null;\n    let jm;\n    while(jm = objRe.exec(html)){\n        lastObj = {\n            open: jm[1],\n            high: jm[2],\n            low: jm[3],\n            close: jm[4]\n        };\n    }\n    // 3) Keyword windows (candlestick / ohlc / series / dataset)\n    const keyRe = /\\b(candlestick|ohlc|open|high|low|close|tradingview|highcharts|chartjs|chart\\.js|lightweight-charts)\\b/gi;\n    let km;\n    while(km = keyRe.exec(html)){\n        const start = Math.max(0, km.index - 350);\n        const end = Math.min(html.length, km.index + 450);\n        const chunk = html.slice(start, end).replace(/\\s+/g, ' ').trim();\n        if (chunk.length > 0) snippets.push(chunk);\n        if (snippets.length >= MAX_CHART_SNIPPETS) break;\n    }\n    const derivedClose = lastOhlc?.close || lastObj?.close || '';\n    return {\n        derivedClose: derivedClose ? String(derivedClose) : '',\n        derivedOhlc: lastOhlc || lastObj || null,\n        snippets: Array.from(new Set(snippets)).slice(0, MAX_CHART_SNIPPETS)\n    };\n}\nfunction corsHeaders(origin) {\n    const allowRaw = process.env.ALLOW_ORIGIN || '*';\n    // Always vary on Origin so CDNs/CDN cache correctly\n    const varyHeader = {\n        'Vary': 'Origin'\n    };\n    if (allowRaw === '*') {\n        return {\n            ...varyHeader,\n            'Access-Control-Allow-Origin': '*',\n            'Access-Control-Allow-Methods': 'POST,GET,OPTIONS',\n            'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n            'Access-Control-Max-Age': '86400'\n        };\n    }\n    // Support comma-separated allow-list: e.g. \"https://www.dexetera.xyz,http://localhost:3000\"\n    const allowList = allowRaw.split(',').map((s)=>s.trim()).filter(Boolean);\n    const isAllowed = origin && allowList.some((allowed)=>origin === allowed || allowed && origin.endsWith(allowed));\n    const acao = isAllowed ? origin : allowList[0] || '*';\n    return {\n        ...varyHeader,\n        'Access-Control-Allow-Origin': acao,\n        'Access-Control-Allow-Methods': 'POST,GET,OPTIONS',\n        'Access-Control-Allow-Headers': 'Content-Type, Authorization',\n        'Access-Control-Max-Age': '86400'\n    };\n}\nasync function OPTIONS(req) {\n    return new Response(null, {\n        status: 204,\n        headers: corsHeaders(req.headers.get('origin') || undefined)\n    });\n}\nasync function POST(req) {\n    try {\n        const body = await req.json();\n        const input = InputSchema.parse(body);\n        const supabase = getSupabase();\n        const jobId = `metric_ai_${Date.now()}_${Math.random().toString(36).slice(2, 10)}`;\n        await supabase.from('metric_oracle_jobs').insert([\n            {\n                job_id: jobId,\n                status: 'processing',\n                progress: 0,\n                metric_input: {\n                    metric: input.metric,\n                    description: input.description || null,\n                    urls: input.urls\n                },\n                created_at: new Date()\n            }\n        ]);\n        (0,next_server__WEBPACK_IMPORTED_MODULE_0__.after)(async ()=>{\n            const started = Date.now();\n            try {\n                const openai = new openai__WEBPACK_IMPORTED_MODULE_1__[\"default\"]({\n                    apiKey: process.env.OPENAI_API_KEY\n                });\n                const texts = [];\n                for (const url of input.urls){\n                    try {\n                        const r = await fetch(url, {\n                            headers: {\n                                'User-Agent': `Dexextra/1.0 (+${process.env.APP_URL || 'https://dexextra.com'})`\n                            }\n                        });\n                        const htmlRaw = (await r.text()).slice(0, MAX_RAW_HTML_CHARS);\n                        const meta = extractMetaTags(htmlRaw);\n                        const textLines = stripTagsToLines(htmlRaw);\n                        const keyLines = collectKeyLines(textLines, [\n                            input.metric,\n                            ...input.description ? input.description.split(/\\s+/).slice(0, 8) : []\n                        ]);\n                        const jsonLd = extractJsonLdPrices(htmlRaw);\n                        const chart = extractChartSignals(htmlRaw);\n                        const digestParts = [];\n                        digestParts.push(`URL: ${url}`);\n                        if (meta.title) digestParts.push(`TITLE: ${meta.title}`);\n                        if (meta.description) digestParts.push(`META_DESCRIPTION: ${meta.description}`);\n                        if (jsonLd.length) {\n                            digestParts.push(`JSON_LD_PRICE_CANDIDATES: ${jsonLd.slice(0, 6).map((x)=>`${x.price}${x.currency ? ' ' + x.currency : ''}${x.context ? ' (' + x.context + ')' : ''}`).join(' | ')}`);\n                        }\n                        if (chart.derivedClose) {\n                            digestParts.push(`CHART_DERIVED_LAST_CLOSE: ${chart.derivedClose}`);\n                            if (chart.derivedOhlc) {\n                                digestParts.push(`CHART_DERIVED_OHLC: ${JSON.stringify(chart.derivedOhlc).slice(0, 500)}`);\n                            }\n                        }\n                        if (chart.snippets.length) {\n                            digestParts.push(`CHART_SNIPPETS:`);\n                            for (const snip of chart.snippets)digestParts.push(`- ${snip.slice(0, 900)}`);\n                        }\n                        digestParts.push(`KEY_LINES:`);\n                        for (const line of keyLines)digestParts.push(`- ${line.slice(0, 500)}`);\n                        const digest = digestParts.join('\\n').slice(0, MAX_SOURCE_DIGEST_CHARS);\n                        texts.push(`SOURCE:\\n${digest}`);\n                    } catch  {}\n                }\n                const prompt = [\n                    `METRIC: ${input.metric}`,\n                    input.description ? `DESCRIPTION: ${input.description}` : '',\n                    `TASK: Determine the current numeric value and a tradable asset_price_suggestion.`,\n                    `Return JSON: { \"value\": \"...\",  \"confidence\": 0.0-1.0, \"asset_price_suggestion\": \"123.45\", \"reasoning\": \"...\", \"source_quotes\": [{ \"url\": \"...\", \"quote\": \"...\", \"match_score\": 0.0-1.0 }] }`,\n                    `PRICE RULES:`,\n                    `- If financial quote (USD per BTC/oz/barrel/etc) use as-is; else rescale large metrics to natural human units.`,\n                    `- asset_price_suggestion must be a numeric string with up to 5 significant figures, no units.`,\n                    `CHART RULES (IMPORTANT):`,\n                    `- If a source provides CHART_DERIVED_LAST_CLOSE or OHLC (open/high/low/close), prefer the latest CLOSE as the asset_price_suggestion.`,\n                    `- Candlestick charts: use CLOSE, not OPEN, unless the chart is explicitly \"current/open\".`,\n                    `- If you use chart-derived pricing, cite the relevant CHART_DERIVED_* or CHART_SNIPPETS in source_quotes.`,\n                    `SOURCES:`,\n                    texts.join('\\n\\n').slice(0, MAX_SOURCES_JOIN_CHARS)\n                ].filter(Boolean).join('\\n');\n                const resp = await openai.chat.completions.create({\n                    model: process.env.OPENAI_MODEL || 'gpt-4.1',\n                    response_format: {\n                        type: 'json_object'\n                    },\n                    messages: [\n                        {\n                            role: 'system',\n                            content: 'You are an expert metric analyst. Return strict JSON only.'\n                        },\n                        {\n                            role: 'user',\n                            content: prompt\n                        }\n                    ],\n                    max_tokens: 1400\n                });\n                let content = resp.choices[0]?.message?.content?.trim() || '{}';\n                try {\n                    content = content.replace(/```json|```/g, '').trim();\n                } catch  {}\n                const json = JSON.parse(content);\n                const resolution = {\n                    metric: input.metric,\n                    value: json.value || 'N/A',\n                    unit: json.unit || 'unknown',\n                    as_of: json.as_of || new Date().toISOString(),\n                    confidence: typeof json.confidence === 'number' ? Math.min(Math.max(json.confidence, 0), 1) : 0.5,\n                    asset_price_suggestion: json.asset_price_suggestion || json.value || '50.00',\n                    reasoning: json.reasoning || '',\n                    sources: Array.isArray(json.source_quotes) ? json.source_quotes.map((q)=>({\n                            url: String(q.url || ''),\n                            screenshot_url: '',\n                            quote: String(q.quote || '').slice(0, 800),\n                            match_score: typeof q.match_score === 'number' ? q.match_score : 0.5\n                        })) : []\n                };\n                let resolutionId = null;\n                try {\n                    const { data, error } = await supabase.from('metric_oracle_resolutions').insert([\n                        {\n                            metric_name: input.metric,\n                            metric_description: input.description || null,\n                            source_urls: input.urls,\n                            resolution_data: resolution,\n                            confidence_score: resolution.confidence,\n                            processing_time_ms: Date.now() - started,\n                            user_address: input.user_address || null,\n                            related_market_id: input.related_market_id || input.related_market_identifier || null,\n                            created_at: new Date()\n                        }\n                    ]).select('id').single();\n                    if (error) throw error;\n                    resolutionId = data?.id || null;\n                } catch (e) {}\n                if (resolutionId && (input.related_market_id || input.related_market_identifier)) {\n                    const update = {\n                        metric_resolution_id: resolutionId,\n                        updated_at: new Date().toISOString()\n                    };\n                    try {\n                        if (input.related_market_id) {\n                            await supabase.from('markets').update(update).eq('id', input.related_market_id);\n                        } else {\n                            await supabase.from('markets').update(update).eq('market_identifier', input.related_market_identifier);\n                        }\n                    } catch  {}\n                }\n                await supabase.from('metric_oracle_jobs').update({\n                    status: 'completed',\n                    progress: 100,\n                    result: resolution,\n                    processing_time_ms: Date.now() - started,\n                    completed_at: new Date()\n                }).eq('job_id', jobId);\n            } catch (err) {\n                await supabase.from('metric_oracle_jobs').update({\n                    status: 'failed',\n                    progress: 100,\n                    error: err?.message || 'unknown',\n                    completed_at: new Date()\n                }).eq('job_id', jobId);\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            status: 'processing',\n            jobId,\n            statusUrl: `/api/metric-ai?jobId=${jobId}`,\n            message: 'AI metric analysis started'\n        }, {\n            status: 202,\n            headers: corsHeaders(req.headers.get('origin') || undefined)\n        });\n    } catch (e) {\n        // Provide structured validation details for easier debugging (esp. local dev).\n        const isZod = e && typeof e === 'object' && e.name === 'ZodError';\n        const issues = isZod ? e.issues : undefined;\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Invalid input',\n            message: e?.message || 'Unknown error',\n            ...issues ? {\n                issues\n            } : {}\n        }, {\n            status: 400,\n            headers: corsHeaders(req.headers.get('origin') || undefined)\n        });\n    }\n}\nasync function GET(req) {\n    try {\n        const { searchParams } = new URL(req.url);\n        const jobId = searchParams.get('jobId');\n        if (!jobId) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Missing jobId'\n            }, {\n                status: 400,\n                headers: corsHeaders(req.headers.get('origin') || undefined)\n            });\n        }\n        const supabase = getSupabase();\n        const { data, error } = await supabase.from('metric_oracle_jobs').select('*').eq('job_id', jobId).single();\n        if (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: 'Job not found'\n            }, {\n                status: 404,\n                headers: corsHeaders(req.headers.get('origin') || undefined)\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json(data, {\n            headers: corsHeaders(req.headers.get('origin') || undefined)\n        });\n    } catch (e) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: 'Failed to fetch job'\n        }, {\n            status: 500,\n            headers: corsHeaders(req.headers.get('origin') || undefined)\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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VTFFLE9BQU9vRSxNQUFNO1FBQ3hHLElBQUlSLE9BQU87WUFDVCxPQUFPdE4scURBQVlBLENBQUM2RixJQUFJLENBQUM7Z0JBQUV5SCxPQUFPO1lBQWdCLEdBQUc7Z0JBQUVsRSxRQUFRO2dCQUFLQyxTQUFTZCxZQUFZVyxJQUFJRyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxhQUFhM0M7WUFBVztRQUNuSTtRQUNBLE9BQU8zRyxxREFBWUEsQ0FBQzZGLElBQUksQ0FBQ3dILE1BQU07WUFBRWhFLFNBQVNkLFlBQVlXLElBQUlHLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLGFBQWEzQztRQUFXO0lBQ2hHLEVBQUUsT0FBT3FILEdBQVE7UUFDZixPQUFPaE8scURBQVlBLENBQUM2RixJQUFJLENBQUM7WUFBRXlILE9BQU87UUFBc0IsR0FBRztZQUFFbEUsUUFBUTtZQUFLQyxTQUFTZCxZQUFZVyxJQUFJRyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxhQUFhM0M7UUFBVztJQUN6STtBQUNGIiwic291cmNlcyI6WyIvVXNlcnMvZ3BsYXlfc2F5aWQvRGVza3RvcC9DT0RFL2RleGV4dHJhL21ldHJpYy1haS13b3JrZXIvYXBwL2FwaS9tZXRyaWMtYWkvcm91dGUudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGFmdGVyIH0gZnJvbSAnbmV4dC9zZXJ2ZXInO1xuaW1wb3J0IHsgeiB9IGZyb20gJ3pvZCc7XG5pbXBvcnQgT3BlbkFJIGZyb20gJ29wZW5haSc7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuXG5leHBvcnQgY29uc3QgcnVudGltZSA9ICdub2RlanMnO1xuZXhwb3J0IGNvbnN0IG1heER1cmF0aW9uID0gMTIwO1xuXG5jb25zdCBJbnB1dFNjaGVtYSA9IHoub2JqZWN0KHtcbiAgbWV0cmljOiB6LnN0cmluZygpLm1pbigxKS5tYXgoNTAwKSxcbiAgZGVzY3JpcHRpb246IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgdXJsczogei5hcnJheSh6LnN0cmluZygpLnVybCgpKS5taW4oMSkubWF4KDEwKSxcbiAgcmVsYXRlZF9tYXJrZXRfaWQ6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgcmVsYXRlZF9tYXJrZXRfaWRlbnRpZmllcjogei5zdHJpbmcoKS5vcHRpb25hbCgpLFxuICB1c2VyX2FkZHJlc3M6IHouc3RyaW5nKCkub3B0aW9uYWwoKSxcbiAgY29udGV4dDogei5lbnVtKFsnY3JlYXRlJywgJ3NldHRsZW1lbnQnXSkub3B0aW9uYWwoKVxufSk7XG5cbmNvbnN0IE1BWF9SQVdfSFRNTF9DSEFSUyA9IE51bWJlcihwcm9jZXNzLmVudi5NRVRSSUNfQUlfTUFYX1JBV19IVE1MX0NIQVJTIHx8IDI1MF8wMDApO1xuY29uc3QgTUFYX1NPVVJDRV9ESUdFU1RfQ0hBUlMgPSBOdW1iZXIocHJvY2Vzcy5lbnYuTUVUUklDX0FJX01BWF9TT1VSQ0VfRElHRVNUX0NIQVJTIHx8IDlfMDAwKTtcbmNvbnN0IE1BWF9TT1VSQ0VTX0pPSU5fQ0hBUlMgPSBOdW1iZXIocHJvY2Vzcy5lbnYuTUVUUklDX0FJX01BWF9TT1VSQ0VTX0pPSU5fQ0hBUlMgfHwgMzBfMDAwKTtcbmNvbnN0IE1BWF9LRVlfTElORVMgPSBOdW1iZXIocHJvY2Vzcy5lbnYuTUVUUklDX0FJX01BWF9LRVlfTElORVMgfHwgNjApO1xuY29uc3QgTUFYX0NIQVJUX1NOSVBQRVRTID0gTnVtYmVyKHByb2Nlc3MuZW52Lk1FVFJJQ19BSV9NQVhfQ0hBUlRfU05JUFBFVFMgfHwgOCk7XG5cbmZ1bmN0aW9uIGdldFN1cGFiYXNlKCkge1xuICBjb25zdCB1cmwgPSBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwgfHwgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfVVJMO1xuICBjb25zdCBrZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIHx8IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfS0VZO1xuICBpZiAoIXVybCB8fCAha2V5KSB0aHJvdyBuZXcgRXJyb3IoJ1N1cGFiYXNlIGVudiBtaXNzaW5nJyk7XG4gIHJldHVybiBjcmVhdGVDbGllbnQodXJsLCBrZXksIHsgYXV0aDogeyBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSwgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0gfSk7XG59XG5cbmZ1bmN0aW9uIHNhZmVUZXh0KHM6IHVua25vd24pIHtcbiAgcmV0dXJuIFN0cmluZyhzID8/ICcnKS5yZXBsYWNlKC9cXHMrL2csICcgJykudHJpbSgpO1xufVxuXG5mdW5jdGlvbiBkZWNvZGVCYXNpY0VudGl0aWVzKGlucHV0OiBzdHJpbmcpIHtcbiAgcmV0dXJuIGlucHV0XG4gICAgLnJlcGxhY2UoLyZuYnNwOy9naSwgJyAnKVxuICAgIC5yZXBsYWNlKC8mYW1wOy9naSwgJyYnKVxuICAgIC5yZXBsYWNlKC8mcXVvdDsvZ2ksICdcIicpXG4gICAgLnJlcGxhY2UoLyYjMzk7L2dpLCBcIidcIilcbiAgICAucmVwbGFjZSgvJmx0Oy9naSwgJzwnKVxuICAgIC5yZXBsYWNlKC8mZ3Q7L2dpLCAnPicpO1xufVxuXG5mdW5jdGlvbiBzdHJpcFRhZ3NUb0xpbmVzKGh0bWw6IHN0cmluZykge1xuICAvLyBLZWVwIGxpbmUgYnJlYWtzIHNvIHdlIGNhbiBzZWxlY3QgXCJwcmljZS1sb29raW5nXCIgbGluZXMgaW5zdGVhZCBvZiBvbmUgZ2lhbnQgYmxvYi5cbiAgY29uc3Qgd2l0aEJyZWFrcyA9IGh0bWxcbiAgICAucmVwbGFjZSgvPHNjcmlwdFtcXHNcXFNdKj88XFwvc2NyaXB0Pi9naSwgJ1xcbicpXG4gICAgLnJlcGxhY2UoLzxzdHlsZVtcXHNcXFNdKj88XFwvc3R5bGU+L2dpLCAnXFxuJylcbiAgICAucmVwbGFjZSgvPFxcLyhwfGRpdnxsaXx0cnx0ZHx0aHxoMXxoMnxoM3xoNHxoNXxoNnxzZWN0aW9ufGFydGljbGV8aGVhZGVyfGZvb3RlcnxicilcXHMqPi9naSwgJ1xcbicpXG4gICAgLnJlcGxhY2UoLzwoYnJ8aHIpXFxzKlxcLz8+L2dpLCAnXFxuJylcbiAgICAucmVwbGFjZSgvPFtePl0rPi9nLCAnICcpO1xuXG4gIHJldHVybiBkZWNvZGVCYXNpY0VudGl0aWVzKHdpdGhCcmVha3MpXG4gICAgLnJlcGxhY2UoL1xcclxcbi9nLCAnXFxuJylcbiAgICAucmVwbGFjZSgvWyBcXHRdK1xcbi9nLCAnXFxuJylcbiAgICAucmVwbGFjZSgvXFxuezMsfS9nLCAnXFxuXFxuJylcbiAgICAudHJpbSgpO1xufVxuXG5mdW5jdGlvbiBjb2xsZWN0S2V5TGluZXModGV4dDogc3RyaW5nLCBleHRyYUtleXdvcmRzOiBzdHJpbmdbXSkge1xuICBjb25zdCBiYXNlID0gW1xuICAgICdwcmljZScsXG4gICAgJ2xhc3QnLFxuICAgICdjbG9zZScsXG4gICAgJ2Nsb3NpbmcnLFxuICAgICdvcGVuJyxcbiAgICAnaGlnaCcsXG4gICAgJ2xvdycsXG4gICAgJ3F1b3RlJyxcbiAgICAnYmlkJyxcbiAgICAnYXNrJyxcbiAgICAndXNkJyxcbiAgICAnZXVyJyxcbiAgICAnZ2JwJyxcbiAgICAnYnRjJyxcbiAgICAnZXRoJyxcbiAgICAncGVyICcsXG4gICAgJyQnLFxuICBdO1xuICBjb25zdCBrdyA9IFsuLi5iYXNlLCAuLi5leHRyYUtleXdvcmRzXS5tYXAoayA9PiBrLnRvTG93ZXJDYXNlKCkpO1xuICBjb25zdCBsaW5lcyA9IHRleHQuc3BsaXQoJ1xcbicpLm1hcChsID0+IGwudHJpbSgpKS5maWx0ZXIoQm9vbGVhbik7XG5cbiAgY29uc3QgcGlja2VkOiBzdHJpbmdbXSA9IFtdO1xuICBmb3IgKGNvbnN0IGxpbmUgb2YgbGluZXMpIHtcbiAgICBjb25zdCBsb3cgPSBsaW5lLnRvTG93ZXJDYXNlKCk7XG4gICAgY29uc3QgaGFzS3cgPSBrdy5zb21lKGsgPT4gKGsgPT09ICckJyA/IGxvdy5pbmNsdWRlcygnJCcpIDogbG93LmluY2x1ZGVzKGspKSk7XG4gICAgY29uc3QgaGFzTnVtYmVyID0gL1stK10/XFxkezEsM30oPzpbLFxcZF17MCwxMn0pPyg/OlxcLlxcZCspPy8udGVzdChsaW5lKTtcbiAgICBpZiAoaGFzS3cgJiYgaGFzTnVtYmVyKSBwaWNrZWQucHVzaChsaW5lKTtcbiAgICBpZiAocGlja2VkLmxlbmd0aCA+PSBNQVhfS0VZX0xJTkVTKSBicmVhaztcbiAgfVxuXG4gIC8vIElmIHdlIGZvdW5kIG5vdGhpbmcsIGZhbGwgYmFjayB0byB0aGUgZmlyc3QgZmV3IGRlbnNlIG51bWVyaWMgbGluZXMuXG4gIGlmIChwaWNrZWQubGVuZ3RoID09PSAwKSB7XG4gICAgZm9yIChjb25zdCBsaW5lIG9mIGxpbmVzKSB7XG4gICAgICBpZiAoKGxpbmUubWF0Y2goL1xcZC9nKSB8fCBbXSkubGVuZ3RoID49IDYpIHBpY2tlZC5wdXNoKGxpbmUpO1xuICAgICAgaWYgKHBpY2tlZC5sZW5ndGggPj0gTWF0aC5taW4oMjAsIE1BWF9LRVlfTElORVMpKSBicmVhaztcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcGlja2VkO1xufVxuXG5mdW5jdGlvbiBleHRyYWN0TWV0YVRhZ3MoaHRtbDogc3RyaW5nKSB7XG4gIGNvbnN0IHJlYWRNZXRhID0gKHJlOiBSZWdFeHApID0+IHtcbiAgICBjb25zdCBtID0gaHRtbC5tYXRjaChyZSk7XG4gICAgcmV0dXJuIG0/LlsxXSA/IGRlY29kZUJhc2ljRW50aXRpZXMobVsxXSkudHJpbSgpIDogJyc7XG4gIH07XG4gIGNvbnN0IHRpdGxlID0gcmVhZE1ldGEoLzx0aXRsZVtePl0qPihbXFxzXFxTXXswLDUwMH0/KTxcXC90aXRsZT4vaSk7XG4gIGNvbnN0IG9nVGl0bGUgPSByZWFkTWV0YSgvPG1ldGFbXj5dK3Byb3BlcnR5PVtcIiddb2c6dGl0bGVbXCInXVtePl0rY29udGVudD1bXCInXShbXlwiJ117MCw1MDB9KVtcIiddW14+XSo+L2kpO1xuICBjb25zdCBkZXNjID0gcmVhZE1ldGEoLzxtZXRhW14+XStuYW1lPVtcIiddZGVzY3JpcHRpb25bXCInXVtePl0rY29udGVudD1bXCInXShbXlwiJ117MCw4MDB9KVtcIiddW14+XSo+L2kpO1xuICBjb25zdCBvZ0Rlc2MgPSByZWFkTWV0YSgvPG1ldGFbXj5dK3Byb3BlcnR5PVtcIiddb2c6ZGVzY3JpcHRpb25bXCInXVtePl0rY29udGVudD1bXCInXShbXlwiJ117MCw4MDB9KVtcIiddW14+XSo+L2kpO1xuICByZXR1cm4ge1xuICAgIHRpdGxlOiBzYWZlVGV4dChvZ1RpdGxlIHx8IHRpdGxlKSxcbiAgICBkZXNjcmlwdGlvbjogc2FmZVRleHQob2dEZXNjIHx8IGRlc2MpLFxuICB9O1xufVxuXG5mdW5jdGlvbiBleHRyYWN0SnNvbkxkUHJpY2VzKGh0bWw6IHN0cmluZykge1xuICAvLyBMb29rIGZvciBQcm9kdWN0L09mZmVyIHN0eWxlIEpTT04tTEQgd2hlcmUgcHJpY2UgaXMgc3RydWN0dXJlZC5cbiAgY29uc3Qgb3V0OiBBcnJheTx7IGN1cnJlbmN5Pzogc3RyaW5nOyBwcmljZT86IHN0cmluZzsgY29udGV4dD86IHN0cmluZyB9PiA9IFtdO1xuICBjb25zdCByZSA9IC88c2NyaXB0W14+XSt0eXBlPVtcIiddYXBwbGljYXRpb25cXC9sZFxcK2pzb25bXCInXVtePl0qPihbXFxzXFxTXSo/KTxcXC9zY3JpcHQ+L2dpO1xuICBsZXQgbTogUmVnRXhwRXhlY0FycmF5IHwgbnVsbDtcbiAgd2hpbGUgKChtID0gcmUuZXhlYyhodG1sKSkpIHtcbiAgICBjb25zdCByYXcgPSAobVsxXSB8fCAnJykudHJpbSgpO1xuICAgIGlmICghcmF3KSBjb250aW51ZTtcbiAgICB0cnkge1xuICAgICAgY29uc3QganNvbiA9IEpTT04ucGFyc2UocmF3KTtcbiAgICAgIGNvbnN0IHN0YWNrOiBhbnlbXSA9IFtqc29uXTtcbiAgICAgIHdoaWxlIChzdGFjay5sZW5ndGgpIHtcbiAgICAgICAgY29uc3QgY3VyID0gc3RhY2sucG9wKCk7XG4gICAgICAgIGlmICghY3VyKSBjb250aW51ZTtcbiAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY3VyKSkge1xuICAgICAgICAgIGZvciAoY29uc3QgeCBvZiBjdXIpIHN0YWNrLnB1c2goeCk7XG4gICAgICAgICAgY29udGludWU7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHR5cGVvZiBjdXIgPT09ICdvYmplY3QnKSB7XG4gICAgICAgICAgLy8gT2ZmZXItbGlrZSBub2Rlc1xuICAgICAgICAgIGNvbnN0IHByaWNlID0gY3VyLnByaWNlID8/IGN1ci5sb3dQcmljZSA/PyBjdXIuaGlnaFByaWNlO1xuICAgICAgICAgIGNvbnN0IGN1cnJlbmN5ID0gY3VyLnByaWNlQ3VycmVuY3kgPz8gY3VyLmN1cnJlbmN5O1xuICAgICAgICAgIGlmIChwcmljZSAhPSBudWxsKSB7XG4gICAgICAgICAgICBvdXQucHVzaCh7XG4gICAgICAgICAgICAgIGN1cnJlbmN5OiBjdXJyZW5jeSA/IFN0cmluZyhjdXJyZW5jeSkgOiB1bmRlZmluZWQsXG4gICAgICAgICAgICAgIHByaWNlOiBTdHJpbmcocHJpY2UpLFxuICAgICAgICAgICAgICBjb250ZXh0OiBjdXJbJ0B0eXBlJ10gPyBTdHJpbmcoY3VyWydAdHlwZSddKSA6IHVuZGVmaW5lZFxuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgfVxuICAgICAgICAgIGZvciAoY29uc3QgdiBvZiBPYmplY3QudmFsdWVzKGN1cikpIHN0YWNrLnB1c2godik7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGNhdGNoIHtcbiAgICAgIC8vIGlnbm9yZSBpbnZhbGlkIGpzb24tbGRcbiAgICB9XG4gICAgaWYgKG91dC5sZW5ndGggPj0gMTApIGJyZWFrO1xuICB9XG4gIHJldHVybiBvdXQ7XG59XG5cbmZ1bmN0aW9uIGV4dHJhY3RDaGFydFNpZ25hbHMocmF3SHRtbDogc3RyaW5nKSB7XG4gIC8vIE1hbnkgXCJjaGFydFwiIHBhZ2VzIHJlbmRlciBwcmljZSBkYXRhIGluc2lkZSBpbmxpbmUgc2NyaXB0cyAvIGVtYmVkZGVkIEpTT04uXG4gIC8vIFdlIGRvIE5PVCBleGVjdXRlIEpTOyB3ZSBqdXN0IHBhdHRlcm4tbWF0Y2ggbGlrZWx5IE9ITEMvY2FuZGxlc3RpY2sgcGF5bG9hZHMuXG4gIGNvbnN0IGh0bWwgPSByYXdIdG1sO1xuICBjb25zdCBzbmlwcGV0czogc3RyaW5nW10gPSBbXTtcblxuICAvLyAxKSBPSExDIGFycmF5czogW3RzLCBvcGVuLCBoaWdoLCBsb3csIGNsb3NlXVxuICBjb25zdCBvaGxjUmUgPSAvXFxbXFxzKihcXGR7MTAsMTN9KVxccyosXFxzKihbLStdP1xcZCsoPzpcXC5cXGQrKT8pXFxzKixcXHMqKFstK10/XFxkKyg/OlxcLlxcZCspPylcXHMqLFxccyooWy0rXT9cXGQrKD86XFwuXFxkKyk/KVxccyosXFxzKihbLStdP1xcZCsoPzpcXC5cXGQrKT8pXFxzKlxcXS9nO1xuICBsZXQgbGFzdE9obGM6IHsgdHM6IHN0cmluZzsgb3Blbjogc3RyaW5nOyBoaWdoOiBzdHJpbmc7IGxvdzogc3RyaW5nOyBjbG9zZTogc3RyaW5nIH0gfCBudWxsID0gbnVsbDtcbiAgbGV0IG9tOiBSZWdFeHBFeGVjQXJyYXkgfCBudWxsO1xuICB3aGlsZSAoKG9tID0gb2hsY1JlLmV4ZWMoaHRtbCkpKSB7XG4gICAgbGFzdE9obGMgPSB7IHRzOiBvbVsxXSwgb3Blbjogb21bMl0sIGhpZ2g6IG9tWzNdLCBsb3c6IG9tWzRdLCBjbG9zZTogb21bNV0gfTtcbiAgfVxuXG4gIC8vIDIpIE9iamVjdC1iYXNlZCBjYW5kbGVzdGlja3M6IHt0aW1lOi4uLiwgb3BlbjouLi4sIGhpZ2g6Li4uLCBsb3c6Li4uLCBjbG9zZTouLi59XG4gIGNvbnN0IG9ialJlID0gL1xce1xccypbXnt9XXswLDIwMDB9P1xcYm9wZW5cXHMqOlxccyooWy0rXT9cXGQrKD86XFwuXFxkKyk/KVxccyosXFxzKlxcYmhpZ2hcXHMqOlxccyooWy0rXT9cXGQrKD86XFwuXFxkKyk/KVxccyosXFxzKlxcYmxvd1xccyo6XFxzKihbLStdP1xcZCsoPzpcXC5cXGQrKT8pXFxzKixcXHMqXFxiY2xvc2VcXHMqOlxccyooWy0rXT9cXGQrKD86XFwuXFxkKyk/KVxccypbLH1dL2c7XG4gIGxldCBsYXN0T2JqOiB7IG9wZW46IHN0cmluZzsgaGlnaDogc3RyaW5nOyBsb3c6IHN0cmluZzsgY2xvc2U6IHN0cmluZyB9IHwgbnVsbCA9IG51bGw7XG4gIGxldCBqbTogUmVnRXhwRXhlY0FycmF5IHwgbnVsbDtcbiAgd2hpbGUgKChqbSA9IG9ialJlLmV4ZWMoaHRtbCkpKSB7XG4gICAgbGFzdE9iaiA9IHsgb3Blbjogam1bMV0sIGhpZ2g6IGptWzJdLCBsb3c6IGptWzNdLCBjbG9zZTogam1bNF0gfTtcbiAgfVxuXG4gIC8vIDMpIEtleXdvcmQgd2luZG93cyAoY2FuZGxlc3RpY2sgLyBvaGxjIC8gc2VyaWVzIC8gZGF0YXNldClcbiAgY29uc3Qga2V5UmUgPSAvXFxiKGNhbmRsZXN0aWNrfG9obGN8b3BlbnxoaWdofGxvd3xjbG9zZXx0cmFkaW5ndmlld3xoaWdoY2hhcnRzfGNoYXJ0anN8Y2hhcnRcXC5qc3xsaWdodHdlaWdodC1jaGFydHMpXFxiL2dpO1xuICBsZXQga206IFJlZ0V4cEV4ZWNBcnJheSB8IG51bGw7XG4gIHdoaWxlICgoa20gPSBrZXlSZS5leGVjKGh0bWwpKSkge1xuICAgIGNvbnN0IHN0YXJ0ID0gTWF0aC5tYXgoMCwga20uaW5kZXggLSAzNTApO1xuICAgIGNvbnN0IGVuZCA9IE1hdGgubWluKGh0bWwubGVuZ3RoLCBrbS5pbmRleCArIDQ1MCk7XG4gICAgY29uc3QgY2h1bmsgPSBodG1sLnNsaWNlKHN0YXJ0LCBlbmQpLnJlcGxhY2UoL1xccysvZywgJyAnKS50cmltKCk7XG4gICAgaWYgKGNodW5rLmxlbmd0aCA+IDApIHNuaXBwZXRzLnB1c2goY2h1bmspO1xuICAgIGlmIChzbmlwcGV0cy5sZW5ndGggPj0gTUFYX0NIQVJUX1NOSVBQRVRTKSBicmVhaztcbiAgfVxuXG4gIGNvbnN0IGRlcml2ZWRDbG9zZSA9IGxhc3RPaGxjPy5jbG9zZSB8fCBsYXN0T2JqPy5jbG9zZSB8fCAnJztcbiAgcmV0dXJuIHtcbiAgICBkZXJpdmVkQ2xvc2U6IGRlcml2ZWRDbG9zZSA/IFN0cmluZyhkZXJpdmVkQ2xvc2UpIDogJycsXG4gICAgZGVyaXZlZE9obGM6IGxhc3RPaGxjIHx8IGxhc3RPYmogfHwgbnVsbCxcbiAgICBzbmlwcGV0czogQXJyYXkuZnJvbShuZXcgU2V0KHNuaXBwZXRzKSkuc2xpY2UoMCwgTUFYX0NIQVJUX1NOSVBQRVRTKSxcbiAgfTtcbn1cblxuZnVuY3Rpb24gY29yc0hlYWRlcnMob3JpZ2luPzogc3RyaW5nKSB7XG4gIGNvbnN0IGFsbG93UmF3ID0gcHJvY2Vzcy5lbnYuQUxMT1dfT1JJR0lOIHx8ICcqJztcbiAgLy8gQWx3YXlzIHZhcnkgb24gT3JpZ2luIHNvIENETnMvQ0ROIGNhY2hlIGNvcnJlY3RseVxuICBjb25zdCB2YXJ5SGVhZGVyID0geyAnVmFyeSc6ICdPcmlnaW4nIGFzIGNvbnN0IH07XG4gIGlmIChhbGxvd1JhdyA9PT0gJyonKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIC4uLnZhcnlIZWFkZXIsXG4gICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctT3JpZ2luJzogJyonLFxuICAgICAgJ0FjY2Vzcy1Db250cm9sLUFsbG93LU1ldGhvZHMnOiAnUE9TVCxHRVQsT1BUSU9OUycsXG4gICAgICAnQWNjZXNzLUNvbnRyb2wtQWxsb3ctSGVhZGVycyc6ICdDb250ZW50LVR5cGUsIEF1dGhvcml6YXRpb24nLFxuICAgICAgJ0FjY2Vzcy1Db250cm9sLU1heC1BZ2UnOiAnODY0MDAnXG4gICAgfTtcbiAgfVxuICAvLyBTdXBwb3J0IGNvbW1hLXNlcGFyYXRlZCBhbGxvdy1saXN0OiBlLmcuIFwiaHR0cHM6Ly93d3cuZGV4ZXRlcmEueHl6LGh0dHA6Ly9sb2NhbGhvc3Q6MzAwMFwiXG4gIGNvbnN0IGFsbG93TGlzdCA9IGFsbG93UmF3LnNwbGl0KCcsJykubWFwKHMgPT4gcy50cmltKCkpLmZpbHRlcihCb29sZWFuKTtcbiAgY29uc3QgaXNBbGxvd2VkID0gb3JpZ2luICYmIGFsbG93TGlzdC5zb21lKGFsbG93ZWQgPT4gb3JpZ2luID09PSBhbGxvd2VkIHx8IChhbGxvd2VkICYmIG9yaWdpbiEuZW5kc1dpdGgoYWxsb3dlZCkpKTtcbiAgY29uc3QgYWNhbyA9IGlzQWxsb3dlZCA/IChvcmlnaW4gYXMgc3RyaW5nKSA6IChhbGxvd0xpc3RbMF0gfHwgJyonKTtcbiAgcmV0dXJuIHtcbiAgICAuLi52YXJ5SGVhZGVyLFxuICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1PcmlnaW4nOiBhY2FvLFxuICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1NZXRob2RzJzogJ1BPU1QsR0VULE9QVElPTlMnLFxuICAgICdBY2Nlc3MtQ29udHJvbC1BbGxvdy1IZWFkZXJzJzogJ0NvbnRlbnQtVHlwZSwgQXV0aG9yaXphdGlvbicsXG4gICAgJ0FjY2Vzcy1Db250cm9sLU1heC1BZ2UnOiAnODY0MDAnXG4gIH07XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBPUFRJT05TKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgcmV0dXJuIG5ldyBSZXNwb25zZShudWxsLCB7IHN0YXR1czogMjA0LCBoZWFkZXJzOiBjb3JzSGVhZGVycyhyZXEuaGVhZGVycy5nZXQoJ29yaWdpbicpIHx8IHVuZGVmaW5lZCkgfSk7XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcTogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKTtcbiAgICBjb25zdCBpbnB1dCA9IElucHV0U2NoZW1hLnBhcnNlKGJvZHkpO1xuXG4gICAgY29uc3Qgc3VwYWJhc2UgPSBnZXRTdXBhYmFzZSgpO1xuICAgIGNvbnN0IGpvYklkID0gYG1ldHJpY19haV8ke0RhdGUubm93KCl9XyR7TWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc2xpY2UoMiwgMTApfWA7XG5cbiAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdtZXRyaWNfb3JhY2xlX2pvYnMnKS5pbnNlcnQoW3tcbiAgICAgIGpvYl9pZDogam9iSWQsXG4gICAgICBzdGF0dXM6ICdwcm9jZXNzaW5nJyxcbiAgICAgIHByb2dyZXNzOiAwLFxuICAgICAgbWV0cmljX2lucHV0OiB7XG4gICAgICAgIG1ldHJpYzogaW5wdXQubWV0cmljLFxuICAgICAgICBkZXNjcmlwdGlvbjogaW5wdXQuZGVzY3JpcHRpb24gfHwgbnVsbCxcbiAgICAgICAgdXJsczogaW5wdXQudXJsc1xuICAgICAgfSxcbiAgICAgIGNyZWF0ZWRfYXQ6IG5ldyBEYXRlKClcbiAgICB9XSk7XG5cbiAgICBhZnRlcihhc3luYyAoKSA9PiB7XG4gICAgICBjb25zdCBzdGFydGVkID0gRGF0ZS5ub3coKTtcbiAgICAgIHRyeSB7XG4gICAgICAgIGNvbnN0IG9wZW5haSA9IG5ldyBPcGVuQUkoeyBhcGlLZXk6IHByb2Nlc3MuZW52Lk9QRU5BSV9BUElfS0VZIH0pO1xuICAgICAgICBjb25zdCB0ZXh0czogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgZm9yIChjb25zdCB1cmwgb2YgaW5wdXQudXJscykge1xuICAgICAgICAgIHRyeSB7XG4gICAgICAgICAgICBjb25zdCByID0gYXdhaXQgZmV0Y2godXJsLCB7IGhlYWRlcnM6IHsgJ1VzZXItQWdlbnQnOiBgRGV4ZXh0cmEvMS4wICgrJHtwcm9jZXNzLmVudi5BUFBfVVJMIHx8ICdodHRwczovL2RleGV4dHJhLmNvbSd9KWAgfSB9KTtcbiAgICAgICAgICAgIGNvbnN0IGh0bWxSYXcgPSAoYXdhaXQgci50ZXh0KCkpLnNsaWNlKDAsIE1BWF9SQVdfSFRNTF9DSEFSUyk7XG5cbiAgICAgICAgICAgIGNvbnN0IG1ldGEgPSBleHRyYWN0TWV0YVRhZ3MoaHRtbFJhdyk7XG4gICAgICAgICAgICBjb25zdCB0ZXh0TGluZXMgPSBzdHJpcFRhZ3NUb0xpbmVzKGh0bWxSYXcpO1xuICAgICAgICAgICAgY29uc3Qga2V5TGluZXMgPSBjb2xsZWN0S2V5TGluZXModGV4dExpbmVzLCBbXG4gICAgICAgICAgICAgIGlucHV0Lm1ldHJpYyxcbiAgICAgICAgICAgICAgLi4uKGlucHV0LmRlc2NyaXB0aW9uID8gaW5wdXQuZGVzY3JpcHRpb24uc3BsaXQoL1xccysvKS5zbGljZSgwLCA4KSA6IFtdKVxuICAgICAgICAgICAgXSk7XG4gICAgICAgICAgICBjb25zdCBqc29uTGQgPSBleHRyYWN0SnNvbkxkUHJpY2VzKGh0bWxSYXcpO1xuICAgICAgICAgICAgY29uc3QgY2hhcnQgPSBleHRyYWN0Q2hhcnRTaWduYWxzKGh0bWxSYXcpO1xuXG4gICAgICAgICAgICBjb25zdCBkaWdlc3RQYXJ0czogc3RyaW5nW10gPSBbXTtcbiAgICAgICAgICAgIGRpZ2VzdFBhcnRzLnB1c2goYFVSTDogJHt1cmx9YCk7XG4gICAgICAgICAgICBpZiAobWV0YS50aXRsZSkgZGlnZXN0UGFydHMucHVzaChgVElUTEU6ICR7bWV0YS50aXRsZX1gKTtcbiAgICAgICAgICAgIGlmIChtZXRhLmRlc2NyaXB0aW9uKSBkaWdlc3RQYXJ0cy5wdXNoKGBNRVRBX0RFU0NSSVBUSU9OOiAke21ldGEuZGVzY3JpcHRpb259YCk7XG4gICAgICAgICAgICBpZiAoanNvbkxkLmxlbmd0aCkge1xuICAgICAgICAgICAgICBkaWdlc3RQYXJ0cy5wdXNoKFxuICAgICAgICAgICAgICAgIGBKU09OX0xEX1BSSUNFX0NBTkRJREFURVM6ICR7anNvbkxkXG4gICAgICAgICAgICAgICAgICAuc2xpY2UoMCwgNilcbiAgICAgICAgICAgICAgICAgIC5tYXAoeCA9PiBgJHt4LnByaWNlfSR7eC5jdXJyZW5jeSA/ICcgJyArIHguY3VycmVuY3kgOiAnJ30ke3guY29udGV4dCA/ICcgKCcgKyB4LmNvbnRleHQgKyAnKScgOiAnJ31gKVxuICAgICAgICAgICAgICAgICAgLmpvaW4oJyB8ICcpfWBcbiAgICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmIChjaGFydC5kZXJpdmVkQ2xvc2UpIHtcbiAgICAgICAgICAgICAgZGlnZXN0UGFydHMucHVzaChgQ0hBUlRfREVSSVZFRF9MQVNUX0NMT1NFOiAke2NoYXJ0LmRlcml2ZWRDbG9zZX1gKTtcbiAgICAgICAgICAgICAgaWYgKGNoYXJ0LmRlcml2ZWRPaGxjKSB7XG4gICAgICAgICAgICAgICAgZGlnZXN0UGFydHMucHVzaChgQ0hBUlRfREVSSVZFRF9PSExDOiAke0pTT04uc3RyaW5naWZ5KGNoYXJ0LmRlcml2ZWRPaGxjKS5zbGljZSgwLCA1MDApfWApO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBpZiAoY2hhcnQuc25pcHBldHMubGVuZ3RoKSB7XG4gICAgICAgICAgICAgIGRpZ2VzdFBhcnRzLnB1c2goYENIQVJUX1NOSVBQRVRTOmApO1xuICAgICAgICAgICAgICBmb3IgKGNvbnN0IHNuaXAgb2YgY2hhcnQuc25pcHBldHMpIGRpZ2VzdFBhcnRzLnB1c2goYC0gJHtzbmlwLnNsaWNlKDAsIDkwMCl9YCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBkaWdlc3RQYXJ0cy5wdXNoKGBLRVlfTElORVM6YCk7XG4gICAgICAgICAgICBmb3IgKGNvbnN0IGxpbmUgb2Yga2V5TGluZXMpIGRpZ2VzdFBhcnRzLnB1c2goYC0gJHtsaW5lLnNsaWNlKDAsIDUwMCl9YCk7XG5cbiAgICAgICAgICAgIGNvbnN0IGRpZ2VzdCA9IGRpZ2VzdFBhcnRzLmpvaW4oJ1xcbicpLnNsaWNlKDAsIE1BWF9TT1VSQ0VfRElHRVNUX0NIQVJTKTtcbiAgICAgICAgICAgIHRleHRzLnB1c2goYFNPVVJDRTpcXG4ke2RpZ2VzdH1gKTtcbiAgICAgICAgICB9IGNhdGNoIHsgLyogc2tpcCBiYWQgc291cmNlcyAqLyB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc3QgcHJvbXB0ID0gW1xuICAgICAgICAgIGBNRVRSSUM6ICR7aW5wdXQubWV0cmljfWAsXG4gICAgICAgICAgaW5wdXQuZGVzY3JpcHRpb24gPyBgREVTQ1JJUFRJT046ICR7aW5wdXQuZGVzY3JpcHRpb259YCA6ICcnLFxuICAgICAgICAgIGBUQVNLOiBEZXRlcm1pbmUgdGhlIGN1cnJlbnQgbnVtZXJpYyB2YWx1ZSBhbmQgYSB0cmFkYWJsZSBhc3NldF9wcmljZV9zdWdnZXN0aW9uLmAsXG4gICAgICAgICAgYFJldHVybiBKU09OOiB7IFwidmFsdWVcIjogXCIuLi5cIiwgIFwiY29uZmlkZW5jZVwiOiAwLjAtMS4wLCBcImFzc2V0X3ByaWNlX3N1Z2dlc3Rpb25cIjogXCIxMjMuNDVcIiwgXCJyZWFzb25pbmdcIjogXCIuLi5cIiwgXCJzb3VyY2VfcXVvdGVzXCI6IFt7IFwidXJsXCI6IFwiLi4uXCIsIFwicXVvdGVcIjogXCIuLi5cIiwgXCJtYXRjaF9zY29yZVwiOiAwLjAtMS4wIH1dIH1gLFxuICAgICAgICAgIGBQUklDRSBSVUxFUzpgLFxuICAgICAgICAgIGAtIElmIGZpbmFuY2lhbCBxdW90ZSAoVVNEIHBlciBCVEMvb3ovYmFycmVsL2V0YykgdXNlIGFzLWlzOyBlbHNlIHJlc2NhbGUgbGFyZ2UgbWV0cmljcyB0byBuYXR1cmFsIGh1bWFuIHVuaXRzLmAsXG4gICAgICAgICAgYC0gYXNzZXRfcHJpY2Vfc3VnZ2VzdGlvbiBtdXN0IGJlIGEgbnVtZXJpYyBzdHJpbmcgd2l0aCB1cCB0byA1IHNpZ25pZmljYW50IGZpZ3VyZXMsIG5vIHVuaXRzLmAsXG4gICAgICAgICAgYENIQVJUIFJVTEVTIChJTVBPUlRBTlQpOmAsXG4gICAgICAgICAgYC0gSWYgYSBzb3VyY2UgcHJvdmlkZXMgQ0hBUlRfREVSSVZFRF9MQVNUX0NMT1NFIG9yIE9ITEMgKG9wZW4vaGlnaC9sb3cvY2xvc2UpLCBwcmVmZXIgdGhlIGxhdGVzdCBDTE9TRSBhcyB0aGUgYXNzZXRfcHJpY2Vfc3VnZ2VzdGlvbi5gLFxuICAgICAgICAgIGAtIENhbmRsZXN0aWNrIGNoYXJ0czogdXNlIENMT1NFLCBub3QgT1BFTiwgdW5sZXNzIHRoZSBjaGFydCBpcyBleHBsaWNpdGx5IFwiY3VycmVudC9vcGVuXCIuYCxcbiAgICAgICAgICBgLSBJZiB5b3UgdXNlIGNoYXJ0LWRlcml2ZWQgcHJpY2luZywgY2l0ZSB0aGUgcmVsZXZhbnQgQ0hBUlRfREVSSVZFRF8qIG9yIENIQVJUX1NOSVBQRVRTIGluIHNvdXJjZV9xdW90ZXMuYCxcbiAgICAgICAgICBgU09VUkNFUzpgLFxuICAgICAgICAgIHRleHRzLmpvaW4oJ1xcblxcbicpLnNsaWNlKDAsIE1BWF9TT1VSQ0VTX0pPSU5fQ0hBUlMpXG4gICAgICAgIF0uZmlsdGVyKEJvb2xlYW4pLmpvaW4oJ1xcbicpO1xuXG4gICAgICAgIGNvbnN0IHJlc3AgPSBhd2FpdCBvcGVuYWkuY2hhdC5jb21wbGV0aW9ucy5jcmVhdGUoe1xuICAgICAgICAgIG1vZGVsOiBwcm9jZXNzLmVudi5PUEVOQUlfTU9ERUwgfHwgJ2dwdC00LjEnLFxuICAgICAgICAgIHJlc3BvbnNlX2Zvcm1hdDogeyB0eXBlOiAnanNvbl9vYmplY3QnIH0sXG4gICAgICAgICAgbWVzc2FnZXM6IFtcbiAgICAgICAgICAgIHsgcm9sZTogJ3N5c3RlbScsIGNvbnRlbnQ6ICdZb3UgYXJlIGFuIGV4cGVydCBtZXRyaWMgYW5hbHlzdC4gUmV0dXJuIHN0cmljdCBKU09OIG9ubHkuJyB9LFxuICAgICAgICAgICAgeyByb2xlOiAndXNlcicsIGNvbnRlbnQ6IHByb21wdCB9XG4gICAgICAgICAgXSxcbiAgICAgICAgICBtYXhfdG9rZW5zOiAxNDAwXG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBjb250ZW50ID0gcmVzcC5jaG9pY2VzWzBdPy5tZXNzYWdlPy5jb250ZW50Py50cmltKCkgfHwgJ3t9JztcbiAgICAgICAgdHJ5IHsgY29udGVudCA9IGNvbnRlbnQucmVwbGFjZSgvYGBganNvbnxgYGAvZywgJycpLnRyaW0oKTsgfSBjYXRjaCB7fVxuICAgICAgICBjb25zdCBqc29uID0gSlNPTi5wYXJzZShjb250ZW50KTtcblxuICAgICAgICBjb25zdCByZXNvbHV0aW9uID0ge1xuICAgICAgICAgIG1ldHJpYzogaW5wdXQubWV0cmljLFxuICAgICAgICAgIHZhbHVlOiBqc29uLnZhbHVlIHx8ICdOL0EnLFxuICAgICAgICAgIHVuaXQ6IGpzb24udW5pdCB8fCAndW5rbm93bicsXG4gICAgICAgICAgYXNfb2Y6IGpzb24uYXNfb2YgfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgICAgICAgIGNvbmZpZGVuY2U6IHR5cGVvZiBqc29uLmNvbmZpZGVuY2UgPT09ICdudW1iZXInID8gTWF0aC5taW4oTWF0aC5tYXgoanNvbi5jb25maWRlbmNlLCAwKSwgMSkgOiAwLjUsXG4gICAgICAgICAgYXNzZXRfcHJpY2Vfc3VnZ2VzdGlvbjoganNvbi5hc3NldF9wcmljZV9zdWdnZXN0aW9uIHx8IGpzb24udmFsdWUgfHwgJzUwLjAwJyxcbiAgICAgICAgICByZWFzb25pbmc6IGpzb24ucmVhc29uaW5nIHx8ICcnLFxuICAgICAgICAgIHNvdXJjZXM6IEFycmF5LmlzQXJyYXkoanNvbi5zb3VyY2VfcXVvdGVzKSA/IGpzb24uc291cmNlX3F1b3Rlcy5tYXAoKHE6IGFueSkgPT4gKHtcbiAgICAgICAgICAgIHVybDogU3RyaW5nKHEudXJsIHx8ICcnKSxcbiAgICAgICAgICAgIHNjcmVlbnNob3RfdXJsOiAnJyxcbiAgICAgICAgICAgIHF1b3RlOiBTdHJpbmcocS5xdW90ZSB8fCAnJykuc2xpY2UoMCwgODAwKSxcbiAgICAgICAgICAgIG1hdGNoX3Njb3JlOiB0eXBlb2YgcS5tYXRjaF9zY29yZSA9PT0gJ251bWJlcicgPyBxLm1hdGNoX3Njb3JlIDogMC41XG4gICAgICAgICAgfSkpIDogW11cbiAgICAgICAgfTtcblxuICAgICAgICBsZXQgcmVzb2x1dGlvbklkOiBzdHJpbmcgfCBudWxsID0gbnVsbDtcbiAgICAgICAgdHJ5IHtcbiAgICAgICAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgICAgICAgLmZyb20oJ21ldHJpY19vcmFjbGVfcmVzb2x1dGlvbnMnKVxuICAgICAgICAgICAgLmluc2VydChbe1xuICAgICAgICAgICAgICBtZXRyaWNfbmFtZTogaW5wdXQubWV0cmljLFxuICAgICAgICAgICAgICBtZXRyaWNfZGVzY3JpcHRpb246IGlucHV0LmRlc2NyaXB0aW9uIHx8IG51bGwsXG4gICAgICAgICAgICAgIHNvdXJjZV91cmxzOiBpbnB1dC51cmxzLFxuICAgICAgICAgICAgICByZXNvbHV0aW9uX2RhdGE6IHJlc29sdXRpb24sXG4gICAgICAgICAgICAgIGNvbmZpZGVuY2Vfc2NvcmU6IHJlc29sdXRpb24uY29uZmlkZW5jZSxcbiAgICAgICAgICAgICAgcHJvY2Vzc2luZ190aW1lX21zOiBEYXRlLm5vdygpIC0gc3RhcnRlZCxcbiAgICAgICAgICAgICAgdXNlcl9hZGRyZXNzOiBpbnB1dC51c2VyX2FkZHJlc3MgfHwgbnVsbCxcbiAgICAgICAgICAgICAgcmVsYXRlZF9tYXJrZXRfaWQ6IGlucHV0LnJlbGF0ZWRfbWFya2V0X2lkIHx8IGlucHV0LnJlbGF0ZWRfbWFya2V0X2lkZW50aWZpZXIgfHwgbnVsbCxcbiAgICAgICAgICAgICAgY3JlYXRlZF9hdDogbmV3IERhdGUoKVxuICAgICAgICAgICAgfV0pXG4gICAgICAgICAgICAuc2VsZWN0KCdpZCcpXG4gICAgICAgICAgICAuc2luZ2xlKCk7XG4gICAgICAgICAgaWYgKGVycm9yKSB0aHJvdyBlcnJvcjtcbiAgICAgICAgICByZXNvbHV0aW9uSWQgPSBkYXRhPy5pZCB8fCBudWxsO1xuICAgICAgICB9IGNhdGNoIChlKSB7IC8qIGxvZy1vbmx5ICovIH1cblxuICAgICAgICBpZiAocmVzb2x1dGlvbklkICYmIChpbnB1dC5yZWxhdGVkX21hcmtldF9pZCB8fCBpbnB1dC5yZWxhdGVkX21hcmtldF9pZGVudGlmaWVyKSkge1xuICAgICAgICAgIGNvbnN0IHVwZGF0ZTogYW55ID0geyBtZXRyaWNfcmVzb2x1dGlvbl9pZDogcmVzb2x1dGlvbklkLCB1cGRhdGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCkgfTtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgaWYgKGlucHV0LnJlbGF0ZWRfbWFya2V0X2lkKSB7XG4gICAgICAgICAgICAgIGF3YWl0IHN1cGFiYXNlLmZyb20oJ21hcmtldHMnKS51cGRhdGUodXBkYXRlKS5lcSgnaWQnLCBpbnB1dC5yZWxhdGVkX21hcmtldF9pZCk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdtYXJrZXRzJykudXBkYXRlKHVwZGF0ZSkuZXEoJ21hcmtldF9pZGVudGlmaWVyJywgaW5wdXQucmVsYXRlZF9tYXJrZXRfaWRlbnRpZmllcik7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfSBjYXRjaCB7fVxuICAgICAgICB9XG5cbiAgICAgICAgYXdhaXQgc3VwYWJhc2UuZnJvbSgnbWV0cmljX29yYWNsZV9qb2JzJykudXBkYXRlKHtcbiAgICAgICAgICBzdGF0dXM6ICdjb21wbGV0ZWQnLFxuICAgICAgICAgIHByb2dyZXNzOiAxMDAsXG4gICAgICAgICAgcmVzdWx0OiByZXNvbHV0aW9uLFxuICAgICAgICAgIHByb2Nlc3NpbmdfdGltZV9tczogRGF0ZS5ub3coKSAtIHN0YXJ0ZWQsXG4gICAgICAgICAgY29tcGxldGVkX2F0OiBuZXcgRGF0ZSgpXG4gICAgICAgIH0pLmVxKCdqb2JfaWQnLCBqb2JJZCk7XG4gICAgICB9IGNhdGNoIChlcnI6IGFueSkge1xuICAgICAgICBhd2FpdCBzdXBhYmFzZS5mcm9tKCdtZXRyaWNfb3JhY2xlX2pvYnMnKS51cGRhdGUoe1xuICAgICAgICAgIHN0YXR1czogJ2ZhaWxlZCcsXG4gICAgICAgICAgcHJvZ3Jlc3M6IDEwMCxcbiAgICAgICAgICBlcnJvcjogZXJyPy5tZXNzYWdlIHx8ICd1bmtub3duJyxcbiAgICAgICAgICBjb21wbGV0ZWRfYXQ6IG5ldyBEYXRlKClcbiAgICAgICAgfSkuZXEoJ2pvYl9pZCcsIGpvYklkKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHtcbiAgICAgICAgc3RhdHVzOiAncHJvY2Vzc2luZycsXG4gICAgICAgIGpvYklkLFxuICAgICAgICBzdGF0dXNVcmw6IGAvYXBpL21ldHJpYy1haT9qb2JJZD0ke2pvYklkfWAsXG4gICAgICAgIG1lc3NhZ2U6ICdBSSBtZXRyaWMgYW5hbHlzaXMgc3RhcnRlZCdcbiAgICAgIH0sXG4gICAgICB7IHN0YXR1czogMjAyLCBoZWFkZXJzOiBjb3JzSGVhZGVycyhyZXEuaGVhZGVycy5nZXQoJ29yaWdpbicpIHx8IHVuZGVmaW5lZCkgfVxuICAgICk7XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIC8vIFByb3ZpZGUgc3RydWN0dXJlZCB2YWxpZGF0aW9uIGRldGFpbHMgZm9yIGVhc2llciBkZWJ1Z2dpbmcgKGVzcC4gbG9jYWwgZGV2KS5cbiAgICBjb25zdCBpc1pvZCA9IGUgJiYgdHlwZW9mIGUgPT09ICdvYmplY3QnICYmIChlIGFzIGFueSkubmFtZSA9PT0gJ1pvZEVycm9yJztcbiAgICBjb25zdCBpc3N1ZXMgPSBpc1pvZCA/IChlIGFzIGFueSkuaXNzdWVzIDogdW5kZWZpbmVkO1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgZXJyb3I6ICdJbnZhbGlkIGlucHV0JywgbWVzc2FnZTogZT8ubWVzc2FnZSB8fCAnVW5rbm93biBlcnJvcicsIC4uLihpc3N1ZXMgPyB7IGlzc3VlcyB9IDoge30pIH0sXG4gICAgICB7IHN0YXR1czogNDAwLCBoZWFkZXJzOiBjb3JzSGVhZGVycyhyZXEuaGVhZGVycy5nZXQoJ29yaWdpbicpIHx8IHVuZGVmaW5lZCkgfVxuICAgICk7XG4gIH1cbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXE6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxLnVybCk7XG4gICAgY29uc3Qgam9iSWQgPSBzZWFyY2hQYXJhbXMuZ2V0KCdqb2JJZCcpO1xuICAgIGlmICgham9iSWQpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnTWlzc2luZyBqb2JJZCcgfSwgeyBzdGF0dXM6IDQwMCwgaGVhZGVyczogY29yc0hlYWRlcnMocmVxLmhlYWRlcnMuZ2V0KCdvcmlnaW4nKSB8fCB1bmRlZmluZWQpIH0pO1xuICAgIH1cbiAgICBjb25zdCBzdXBhYmFzZSA9IGdldFN1cGFiYXNlKCk7XG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgc3VwYWJhc2UuZnJvbSgnbWV0cmljX29yYWNsZV9qb2JzJykuc2VsZWN0KCcqJykuZXEoJ2pvYl9pZCcsIGpvYklkKS5zaW5nbGUoKTtcbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnSm9iIG5vdCBmb3VuZCcgfSwgeyBzdGF0dXM6IDQwNCwgaGVhZGVyczogY29yc0hlYWRlcnMocmVxLmhlYWRlcnMuZ2V0KCdvcmlnaW4nKSB8fCB1bmRlZmluZWQpIH0pO1xuICAgIH1cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oZGF0YSwgeyBoZWFkZXJzOiBjb3JzSGVhZGVycyhyZXEuaGVhZGVycy5nZXQoJ29yaWdpbicpIHx8IHVuZGVmaW5lZCkgfSk7XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiAnRmFpbGVkIHRvIGZldGNoIGpvYicgfSwgeyBzdGF0dXM6IDUwMCwgaGVhZGVyczogY29yc0hlYWRlcnMocmVxLmhlYWRlcnMuZ2V0KCdvcmlnaW4nKSB8fCB1bmRlZmluZWQpIH0pO1xuICB9XG59XG5cblxuIl0sIm5hbWVzIjpbIk5leHRSZXNwb25zZSIsImFmdGVyIiwieiIsIk9wZW5BSSIsImNyZWF0ZUNsaWVudCIsInJ1bnRpbWUiLCJtYXhEdXJhdGlvbiIsIklucHV0U2NoZW1hIiwib2JqZWN0IiwibWV0cmljIiwic3RyaW5nIiwibWluIiwibWF4IiwiZGVzY3JpcHRpb24iLCJvcHRpb25hbCIsInVybHMiLCJhcnJheSIsInVybCIsInJlbGF0ZWRfbWFya2V0X2lkIiwicmVsYXRlZF9tYXJrZXRfaWRlbnRpZmllciIsInVzZXJfYWRkcmVzcyIsImNvbnRleHQiLCJlbnVtIiwiTUFYX1JBV19IVE1MX0NIQVJTIiwiTnVtYmVyIiwicHJvY2VzcyIsImVudiIsIk1FVFJJQ19BSV9NQVhfUkFXX0hUTUxfQ0hBUlMiLCJNQVhfU09VUkNFX0RJR0VTVF9DSEFSUyIsIk1FVFJJQ19BSV9NQVhfU09VUkNFX0RJR0VTVF9DSEFSUyIsIk1BWF9TT1VSQ0VTX0pPSU5fQ0hBUlMiLCJNRVRSSUNfQUlfTUFYX1NPVVJDRVNfSk9JTl9DSEFSUyIsIk1BWF9LRVlfTElORVMiLCJNRVRSSUNfQUlfTUFYX0tFWV9MSU5FUyIsIk1BWF9DSEFSVF9TTklQUEVUUyIsIk1FVFJJQ19BSV9NQVhfQ0hBUlRfU05JUFBFVFMiLCJnZXRTdXBhYmFzZSIsIk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCIsIlNVUEFCQVNFX1VSTCIsImtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJTVVBBQkFTRV9TRVJWSUNFX0tFWSIsIkVycm9yIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiIsInNhZmVUZXh0IiwicyIsIlN0cmluZyIsInJlcGxhY2UiLCJ0cmltIiwiZGVjb2RlQmFzaWNFbnRpdGllcyIsImlucHV0Iiwic3RyaXBUYWdzVG9MaW5lcyIsImh0bWwiLCJ3aXRoQnJlYWtzIiwiY29sbGVjdEtleUxpbmVzIiwidGV4dCIsImV4dHJhS2V5d29yZHMiLCJiYXNlIiwia3ciLCJtYXAiLCJrIiwidG9Mb3dlckNhc2UiLCJsaW5lcyIsInNwbGl0IiwibCIsImZpbHRlciIsIkJvb2xlYW4iLCJwaWNrZWQiLCJsaW5lIiwibG93IiwiaGFzS3ciLCJzb21lIiwiaW5jbHVkZXMiLCJoYXNOdW1iZXIiLCJ0ZXN0IiwicHVzaCIsImxlbmd0aCIsIm1hdGNoIiwiTWF0aCIsImV4dHJhY3RNZXRhVGFncyIsInJlYWRNZXRhIiwicmUiLCJtIiwidGl0bGUiLCJvZ1RpdGxlIiwiZGVzYyIsIm9nRGVzYyIsImV4dHJhY3RKc29uTGRQcmljZXMiLCJvdXQiLCJleGVjIiwicmF3IiwianNvbiIsIkpTT04iLCJwYXJzZSIsInN0YWNrIiwiY3VyIiwicG9wIiwiQXJyYXkiLCJpc0FycmF5IiwieCIsInByaWNlIiwibG93UHJpY2UiLCJoaWdoUHJpY2UiLCJjdXJyZW5jeSIsInByaWNlQ3VycmVuY3kiLCJ1bmRlZmluZWQiLCJ2IiwiT2JqZWN0IiwidmFsdWVzIiwiZXh0cmFjdENoYXJ0U2lnbmFscyIsInJhd0h0bWwiLCJzbmlwcGV0cyIsIm9obGNSZSIsImxhc3RPaGxjIiwib20iLCJ0cyIsIm9wZW4iLCJoaWdoIiwiY2xvc2UiLCJvYmpSZSIsImxhc3RPYmoiLCJqbSIsImtleVJlIiwia20iLCJzdGFydCIsImluZGV4IiwiZW5kIiwiY2h1bmsiLCJzbGljZSIsImRlcml2ZWRDbG9zZSIsImRlcml2ZWRPaGxjIiwiZnJvbSIsIlNldCIsImNvcnNIZWFkZXJzIiwib3JpZ2luIiwiYWxsb3dSYXciLCJBTExPV19PUklHSU4iLCJ2YXJ5SGVhZGVyIiwiYWxsb3dMaXN0IiwiaXNBbGxvd2VkIiwiYWxsb3dlZCIsImVuZHNXaXRoIiwiYWNhbyIsIk9QVElPTlMiLCJyZXEiLCJSZXNwb25zZSIsInN0YXR1cyIsImhlYWRlcnMiLCJnZXQiLCJQT1NUIiwiYm9keSIsInN1cGFiYXNlIiwiam9iSWQiLCJEYXRlIiwibm93IiwicmFuZG9tIiwidG9TdHJpbmciLCJpbnNlcnQiLCJqb2JfaWQiLCJwcm9ncmVzcyIsIm1ldHJpY19pbnB1dCIsImNyZWF0ZWRfYXQiLCJzdGFydGVkIiwib3BlbmFpIiwiYXBpS2V5IiwiT1BFTkFJX0FQSV9LRVkiLCJ0ZXh0cyIsInIiLCJmZXRjaCIsIkFQUF9VUkwiLCJodG1sUmF3IiwibWV0YSIsInRleHRMaW5lcyIsImtleUxpbmVzIiwianNvbkxkIiwiY2hhcnQiLCJkaWdlc3RQYXJ0cyIsImpvaW4iLCJzdHJpbmdpZnkiLCJzbmlwIiwiZGlnZXN0IiwicHJvbXB0IiwicmVzcCIsImNoYXQiLCJjb21wbGV0aW9ucyIsImNyZWF0ZSIsIm1vZGVsIiwiT1BFTkFJX01PREVMIiwicmVzcG9uc2VfZm9ybWF0IiwidHlwZSIsIm1lc3NhZ2VzIiwicm9sZSIsImNvbnRlbnQiLCJtYXhfdG9rZW5zIiwiY2hvaWNlcyIsIm1lc3NhZ2UiLCJyZXNvbHV0aW9uIiwidmFsdWUiLCJ1bml0IiwiYXNfb2YiLCJ0b0lTT1N0cmluZyIsImNvbmZpZGVuY2UiLCJhc3NldF9wcmljZV9zdWdnZXN0aW9uIiwicmVhc29uaW5nIiwic291cmNlcyIsInNvdXJjZV9xdW90ZXMiLCJxIiwic2NyZWVuc2hvdF91cmwiLCJxdW90ZSIsIm1hdGNoX3Njb3JlIiwicmVzb2x1dGlvbklkIiwiZGF0YSIsImVycm9yIiwibWV0cmljX25hbWUiLCJtZXRyaWNfZGVzY3JpcHRpb24iLCJzb3VyY2VfdXJscyIsInJlc29sdXRpb25fZGF0YSIsImNvbmZpZGVuY2Vfc2NvcmUiLCJwcm9jZXNzaW5nX3RpbWVfbXMiLCJzZWxlY3QiLCJzaW5nbGUiLCJpZCIsImUiLCJ1cGRhdGUiLCJtZXRyaWNfcmVzb2x1dGlvbl9pZCIsInVwZGF0ZWRfYXQiLCJlcSIsInJlc3VsdCIsImNvbXBsZXRlZF9hdCIsImVyciIsInN0YXR1c1VybCIsImlzWm9kIiwibmFtZSIsImlzc3VlcyIsIkdFVCIsInNlYXJjaFBhcmFtcyIsIlVSTCJdLCJpZ25vcmVMaXN0IjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/metric-ai/route.ts\n");

/***/ }),

/***/ "(ssr)/../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true!":
/*!*******************************************************************************************************!*\
  !*** ../node_modules/next/dist/build/webpack/loaders/next-flight-client-entry-loader.js?server=true! ***!
  \*******************************************************************************************************/
/***/ (() => {



/***/ }),

/***/ "../app-render/after-task-async-storage.external":
/*!***********************************************************************************!*\
  !*** external "next/dist/server/app-render/after-task-async-storage.external.js" ***!
  \***********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/after-task-async-storage.external.js");

/***/ }),

/***/ "../app-render/work-async-storage.external":
/*!*****************************************************************************!*\
  !*** external "next/dist/server/app-render/work-async-storage.external.js" ***!
  \*****************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-async-storage.external.js");

/***/ }),

/***/ "./work-unit-async-storage.external":
/*!**********************************************************************************!*\
  !*** external "next/dist/server/app-render/work-unit-async-storage.external.js" ***!
  \**********************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/server/app-render/work-unit-async-storage.external.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

"use strict";
module.exports = require("https");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

"use strict";
module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

"use strict";
module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

"use strict";
module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

"use strict";
module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

"use strict";
module.exports = require("zlib");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/openai","vendor-chunks/@supabase","vendor-chunks/zod","vendor-chunks/whatwg-url","vendor-chunks/tr46","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/../node_modules/next/dist/build/webpack/loaders/next-app-loader/index.js?name=app%2Fapi%2Fmetric-ai%2Froute&page=%2Fapi%2Fmetric-ai%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fmetric-ai%2Froute.ts&appDir=%2FUsers%2Fgplay_sayid%2FDesktop%2FCODE%2Fdexextra%2Fmetric-ai-worker%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fgplay_sayid%2FDesktop%2FCODE%2Fdexextra%2Fmetric-ai-worker&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();